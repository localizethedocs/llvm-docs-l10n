
<!DOCTYPE html>

<html lang="zh-TW" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>llvm-exegesis - LLVM Machine Instruction Benchmark &#8212; LLVM 7 說明文件</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="../_static/llvm-theme.css?v=4c4af0c1" />
    <script src="../_static/documentation_options.js?v=66322132"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=cbf116e0"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/llvm-docs-l10n/CommandGuide/llvm-exegesis.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜尋" href="../search.html" />
    <link rel="next" title="llvm-pdbutil - PDB File forensics and diagnostics" href="llvm-pdbutil.html" />
    <link rel="prev" title="llvm-build - LLVM Project Build Utility" href="llvm-build.html" />
<script type="text/javascript" src="../ltd-provenance.js"></script>
<script type="text/javascript" src="../ltd-current.js"></script>
<script type="text/javascript" src="../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../ltd-flyout.js"></script>

  </head><body>
<div class="logo">
  <a href="../index.html">
    <img src="../_static/logo.png"
         alt="LLVM Logo" width="250" height="88"/></a>
</div>

    <div class="related" role="navigation" aria-label="Related">
      <h3>瀏覽</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="總索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="llvm-pdbutil.html" title="llvm-pdbutil - PDB File forensics and diagnostics"
             accesskey="N">下一頁</a> |</li>
        <li class="right" >
          <a href="llvm-build.html" title="llvm-build - LLVM Project Build Utility"
             accesskey="P">上一頁</a> |</li>
  <li><a href="https://llvm.org/">LLVM Home</a>&nbsp;|&nbsp;</li>
  <li><a href="../index.html">Documentation</a>&raquo;</li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">LLVM Command Guide</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">llvm-exegesis - LLVM Machine Instruction Benchmark</a></li> 
      </ul>
    </div>


    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="llvm-exegesis-llvm-machine-instruction-benchmark">
<h1>llvm-exegesis - LLVM Machine Instruction Benchmark<a class="headerlink" href="#llvm-exegesis-llvm-machine-instruction-benchmark" title="連結到這個標頭">¶</a></h1>
<section id="synopsis">
<h2>SYNOPSIS<a class="headerlink" href="#synopsis" title="連結到這個標頭">¶</a></h2>
<p><strong class="program">llvm-exegesis</strong> [<em>options</em>]</p>
</section>
<section id="description">
<h2>DESCRIPTION<a class="headerlink" href="#description" title="連結到這個標頭">¶</a></h2>
<p><strong class="program">llvm-exegesis</strong> is a benchmarking tool that uses information available
in LLVM to measure host machine instruction characteristics like latency or port
decomposition.</p>
<p>Given an LLVM opcode name and a benchmarking mode, <strong class="program">llvm-exegesis</strong>
generates a code snippet that makes execution as serial (resp. as parallel) as
possible so that we can measure the latency (resp. uop decomposition) of the
instruction.
The code snippet is jitted and executed on the host subtarget. The time taken
(resp. resource usage) is measured using hardware performance counters. The
result is printed out as YAML to the standard output.</p>
<p>The main goal of this tool is to automatically (in)validate the LLVM's TableDef
scheduling models. To that end, we also provide analysis of the results.</p>
</section>
<section id="examples-benchmarking">
<h2>EXAMPLES: benchmarking<a class="headerlink" href="#examples-benchmarking" title="連結到這個標頭">¶</a></h2>
<p>Assume you have an X86-64 machine. To measure the latency of a single
instruction, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>llvm-exegesis<span class="w"> </span>-mode<span class="o">=</span>latency<span class="w"> </span>-opcode-name<span class="o">=</span>ADD64rr
</pre></div>
</div>
<p>Measuring the uop decomposition of an instruction works similarly:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>llvm-exegesis<span class="w"> </span>-mode<span class="o">=</span>uops<span class="w"> </span>-opcode-name<span class="o">=</span>ADD64rr
</pre></div>
</div>
<p>The output is a YAML document (the default is to write to stdout, but you can
redirect the output to a file using <cite>-benchmarks-file</cite>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>---
key:
  opcode_name:     ADD64rr
  mode:            latency
  config:          &#39;&#39;
cpu_name:        haswell
llvm_triple:     x86_64-unknown-linux-gnu
num_repetitions: 10000
measurements:
  - { key: latency, value: 1.0058, debug_string: &#39;&#39; }
error:           &#39;&#39;
info:            &#39;explicit self cycles, selecting one aliasing configuration.
Snippet:
ADD64rr R8, R8, R10
&#39;
...
</pre></div>
</div>
<p>To measure the latency of all instructions for the host architecture, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">readonly</span><span class="w"> </span><span class="nv">INSTRUCTIONS</span><span class="o">=</span><span class="k">$(($(</span>grep<span class="w"> </span>INSTRUCTION_LIST_END<span class="w"> </span>build/lib/Target/X86/X86GenInstrInfo.inc<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f2<span class="w"> </span>-d<span class="o">=</span><span class="k">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="k">))</span>
<span class="k">for</span><span class="w"> </span>INSTRUCTION<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>seq<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="si">${</span><span class="nv">INSTRUCTIONS</span><span class="si">}</span><span class="k">)</span><span class="p">;</span>
<span class="k">do</span>
<span class="w">  </span>./build/bin/llvm-exegesis<span class="w"> </span>-mode<span class="o">=</span>latency<span class="w"> </span>-opcode-index<span class="o">=</span><span class="si">${</span><span class="nv">INSTRUCTION</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-n<span class="w"> </span><span class="s1">&#39;/---/,$p&#39;</span>
<span class="k">done</span>
</pre></div>
</div>
<p>FIXME: Provide an <strong class="program">llvm-exegesis</strong> option to test all instructions.</p>
</section>
<section id="examples-analysis">
<h2>EXAMPLES: analysis<a class="headerlink" href="#examples-analysis" title="連結到這個標頭">¶</a></h2>
<p>Assuming you have a set of benchmarked instructions (either latency or uops) as
YAML in file <cite>/tmp/benchmarks.yaml</cite>, you can analyze the results using the
following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">  </span>$<span class="w"> </span>llvm-exegesis<span class="w"> </span>-mode<span class="o">=</span>analysis<span class="w"> </span><span class="se">\</span>
-benchmarks-file<span class="o">=</span>/tmp/benchmarks.yaml<span class="w"> </span><span class="se">\</span>
-analysis-clusters-output-file<span class="o">=</span>/tmp/clusters.csv<span class="w"> </span><span class="se">\</span>
-analysis-inconsistencies-output-file<span class="o">=</span>/tmp/inconsistencies.txt
</pre></div>
</div>
<p>This will group the instructions into clusters with the same performance
characteristics. The clusters will be written out to <cite>/tmp/clusters.csv</cite> in the
following format:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cluster_id,opcode_name,config,sched_class
...
2,ADD32ri8_DB,,WriteALU,1.00
2,ADD32ri_DB,,WriteALU,1.01
2,ADD32rr,,WriteALU,1.01
2,ADD32rr_DB,,WriteALU,1.00
2,ADD32rr_REV,,WriteALU,1.00
2,ADD64i32,,WriteALU,1.01
2,ADD64ri32,,WriteALU,1.01
2,MOVSX64rr32,,BSWAP32r_BSWAP64r_MOVSX64rr32,1.00
2,VPADDQYrr,,VPADDBYrr_VPADDDYrr_VPADDQYrr_VPADDWYrr_VPSUBBYrr_VPSUBDYrr_VPSUBQYrr_VPSUBWYrr,1.02
2,VPSUBQYrr,,VPADDBYrr_VPADDDYrr_VPADDQYrr_VPADDWYrr_VPSUBBYrr_VPSUBDYrr_VPSUBQYrr_VPSUBWYrr,1.01
2,ADD64ri8,,WriteALU,1.00
2,SETBr,,WriteSETCC,1.01
...
</pre></div>
</div>
<p><strong class="program">llvm-exegesis</strong> will also analyze the clusters to point out
inconsistencies in the scheduling information. The output is an html file. For
example, <cite>/tmp/inconsistencies.html</cite> will contain messages like the following :</p>
<img alt="../_images/llvm-exegesis-analysis.png" class="align-center" src="../_images/llvm-exegesis-analysis.png" />
<p>Note that the scheduling class names will be resolved only when
<strong class="program">llvm-exegesis</strong> is compiled in debug mode, else only the class id will
be shown. This does not invalidate any of the analysis results though.</p>
</section>
<section id="options">
<h2>OPTIONS<a class="headerlink" href="#options" title="連結到這個標頭">¶</a></h2>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-help">
<span class="sig-name descname"><span class="pre">-help</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-help" title="連結到這個定義">¶</a></dt>
<dd><p>Print a summary of command line options.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-opcode-index">
<span class="sig-name descname"><span class="pre">-opcode-index</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;LLVM</span> <span class="pre">opcode</span> <span class="pre">index&gt;</span></span><a class="headerlink" href="#cmdoption-opcode-index" title="連結到這個定義">¶</a></dt>
<dd><p>Specify the opcode to measure, by index.
Either <cite>opcode-index</cite> or <cite>opcode-name</cite> must be set.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-opcode-name">
<span class="sig-name descname"><span class="pre">-opcode-name</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;LLVM</span> <span class="pre">opcode</span> <span class="pre">name&gt;</span></span><a class="headerlink" href="#cmdoption-opcode-name" title="連結到這個定義">¶</a></dt>
<dd><p>Specify the opcode to measure, by name.
Either <cite>opcode-index</cite> or <cite>opcode-name</cite> must be set.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mode">
<span class="sig-name descname"><span class="pre">-mode</span></span><span class="sig-prename descclassname"><span class="pre">=[latency|uops|analysis]</span></span><a class="headerlink" href="#cmdoption-mode" title="連結到這個定義">¶</a></dt>
<dd><p>Specify the run mode.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-num-repetitions">
<span class="sig-name descname"><span class="pre">-num-repetitions</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;Number</span> <span class="pre">of</span> <span class="pre">repetition&gt;</span></span><a class="headerlink" href="#cmdoption-num-repetitions" title="連結到這個定義">¶</a></dt>
<dd><p>Specify the number of repetitions of the asm snippet.
Higher values lead to more accurate measurements but lengthen the benchmark.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-benchmarks-file">
<span class="sig-name descname"><span class="pre">-benchmarks-file</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;/path/to/file&gt;</span></span><a class="headerlink" href="#cmdoption-benchmarks-file" title="連結到這個定義">¶</a></dt>
<dd><p>File to read (<cite>analysis</cite> mode) or write (<cite>latency</cite>/<cite>uops</cite> modes) benchmark
results. &quot;-&quot; uses stdin/stdout.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-analysis-clusters-output-file">
<span class="sig-name descname"><span class="pre">-analysis-clusters-output-file</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;/path/to/file&gt;</span></span><a class="headerlink" href="#cmdoption-analysis-clusters-output-file" title="連結到這個定義">¶</a></dt>
<dd><p>If provided, write the analysis clusters as CSV to this file. &quot;-&quot; prints to
stdout.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-analysis-inconsistencies-output-file">
<span class="sig-name descname"><span class="pre">-analysis-inconsistencies-output-file</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;/path/to/file&gt;</span></span><a class="headerlink" href="#cmdoption-analysis-inconsistencies-output-file" title="連結到這個定義">¶</a></dt>
<dd><p>If non-empty, write inconsistencies found during analysis to this file. <cite>-</cite>
prints to stdout.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-analysis-numpoints">
<span class="sig-name descname"><span class="pre">-analysis-numpoints</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;dbscan</span> <span class="pre">numPoints</span> <span class="pre">parameter&gt;</span></span><a class="headerlink" href="#cmdoption-analysis-numpoints" title="連結到這個定義">¶</a></dt>
<dd><p>Specify the numPoints parameters to be used for DBSCAN clustering
(<cite>analysis</cite> mode).</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-analysis-espilon">
<span class="sig-name descname"><span class="pre">-analysis-espilon</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;dbscan</span> <span class="pre">epsilon</span> <span class="pre">parameter&gt;</span></span><a class="headerlink" href="#cmdoption-analysis-espilon" title="連結到這個定義">¶</a></dt>
<dd><p>Specify the numPoints parameters to be used for DBSCAN clustering
(<cite>analysis</cite> mode).</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-ignore-invalid-sched-class">
<span class="sig-name descname"><span class="pre">-ignore-invalid-sched-class</span></span><span class="sig-prename descclassname"><span class="pre">=false</span></span><a class="headerlink" href="#cmdoption-ignore-invalid-sched-class" title="連結到這個定義">¶</a></dt>
<dd><p>If set, ignore instructions that do not have a sched class (class idx = 0).</p>
</dd></dl>

</section>
<section id="exit-status">
<h2>EXIT STATUS<a class="headerlink" href="#exit-status" title="連結到這個標頭">¶</a></h2>
<p><strong class="program">llvm-exegesis</strong> returns 0 on success. Otherwise, an error message is
printed to standard error, and the tool returns a non 0 value.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>瀏覽</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="總索引"
             >索引</a></li>
        <li class="right" >
          <a href="llvm-pdbutil.html" title="llvm-pdbutil - PDB File forensics and diagnostics"
             >下一頁</a> |</li>
        <li class="right" >
          <a href="llvm-build.html" title="llvm-build - LLVM Project Build Utility"
             >上一頁</a> |</li>
  <li><a href="https://llvm.org/">LLVM Home</a>&nbsp;|&nbsp;</li>
  <li><a href="../index.html">Documentation</a>&raquo;</li>

          <li class="nav-item nav-item-1"><a href="index.html" >LLVM Command Guide</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">llvm-exegesis - LLVM Machine Instruction Benchmark</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; 版權所有 2003-2025, LLVM Project.
      最後更新於 2025-11-11。
      使用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3 建立。
    </div>
  </body>
</html>