
<!DOCTYPE html>

<html lang="zh-CN" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MemTagSanitizer &#8212; LLVM 10 文档</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="_static/llvm-theme.css?v=4c4af0c1" />
    <script src="_static/documentation_options.js?v=7c1645eb"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/translations.js?v=beaddf03"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/llvm-docs-l10n/MemTagSanitizer.html" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="Segmented Stacks in LLVM" href="SegmentedStacks.html" />
    <link rel="prev" title="Scudo Hardened Allocator" href="ScudoHardenedAllocator.html" />
<script type="text/javascript" src="ltd-provenance.js"></script>
<script type="text/javascript" src="ltd-current.js"></script>
<script type="text/javascript" src="../../ltd-config.js"></script>
<script type="text/javascript" src="../../ltd-flyout.js"></script>

  </head><body>
<div class="logo">
  <a href="index.html">
    <img src="_static/logo.png"
         alt="LLVM Logo" width="250" height="88"/></a>
</div>

    <div class="related" role="navigation" aria-label="Related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="SegmentedStacks.html" title="Segmented Stacks in LLVM"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="ScudoHardenedAllocator.html" title="Scudo Hardened Allocator"
             accesskey="P">上一页</a> |</li>
  <li><a href="https://llvm.org/">LLVM Home</a>&nbsp;|&nbsp;</li>
  <li><a href="index.html">Documentation</a>&raquo;</li>

          <li class="nav-item nav-item-1"><a href="Reference.html" accesskey="U">Reference</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MemTagSanitizer</a></li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">

<h3>Documentation</h3>

<ul class="want-points">
    <li><a href="GettingStartedTutorials.html">Getting Started/Tutorials</a></li>
    <li><a href="UserGuides.html">User Guides</a></li>
    <li><a href="Reference.html">Reference</a></li>
</ul>

<h3>Getting Involved</h3>

<ul class="want-points">
    <li><a href="Contributing.html">Contributing to LLVM</a></li>
    <li><a href="HowToSubmitABug.html">Submitting Bug Reports</a></li>
    <li><a href="GettingInvolved.html#mailing-lists">Mailing Lists</a></li>
    <li><a href="GettingInvolved.html#discord">Discord</a></li>
    <li><a href="GettingInvolved.html#meetups-and-social-events">Meetups and Social Events</a></li>
</ul>

<h3>Additional Links</h3>

<ul class="want-points">
    <li><a href="FAQ.html">FAQ</a></li>
    <li><a href="Lexicon.html">Glossary</a></li>
    <li><a href="https://llvm.org/pubs">Publications</a></li>
    <li><a href="https://github.com/llvm/llvm-project/">Github Repository</a></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/MemTagSanitizer.rst.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="提交" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="memtagsanitizer">
<h1>MemTagSanitizer<a class="headerlink" href="#memtagsanitizer" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="id1">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id2">Introduction</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id3">Usage</a></p></li>
<li><p><a class="reference internal" href="#implementation" id="id4">Implementation</a></p></li>
<li><p><a class="reference internal" href="#stack-instrumentation" id="id5">Stack instrumentation</a></p></li>
<li><p><a class="reference internal" href="#heap-tagging" id="id6">Heap tagging</a></p></li>
<li><p><a class="reference internal" href="#more-information" id="id7">More information</a></p></li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p><strong>Note:</strong> this page describes a tool under development. Part of this
functionality is planned but not implemented.  Hardware capable of
running MemTagSanitizer does not exist as of Oct 2019.</p>
<p>MemTagSanitizer is a fast memory error detector and <strong>a code hardening
tool</strong> based on ARMv9 <a class="reference external" href="https://community.arm.com/developer/ip-products/processors/b/processors-ip-blog/posts/arm-a-profile-architecture-2018-developments-armv85a">Memory Tagging Extension</a>. It
detects a similar class of errors as <a class="reference external" href="https://clang.llvm.org/docs/AddressSanitizer.html">AddressSanitizer</a> or <a class="reference external" href="https://clang.llvm.org/docs/HardwareAssistedAddressSanitizerDesign.html">HardwareAssistedAddressSanitizer</a>, but with
<strong>much</strong> lower overhead.</p>
<p>MemTagSanitizer overhead is expected to be in low single digits, both
CPU and memory. There are plans for a debug mode with slightly higher
memory overhead and better diagnostics. The primary use case of
MemTagSanitizer is code hardening in production binaries, where it is
expected to be a strong mitigation for both stack and heap-based
memory bugs.</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p>Compile and link your program with <code class="docutils literal notranslate"><span class="pre">-fsanitize=memtag</span></code> flag. This
will only work when targeting AArch64 with MemTag extension. One
possible way to achieve that is to add <code class="docutils literal notranslate"><span class="pre">-target</span>
<span class="pre">aarch64-linux</span> <span class="pre">-march=armv8+memtag</span></code> to compilation flags.</p>
</section>
<section id="implementation">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Implementation</a><a class="headerlink" href="#implementation" title="Link to this heading">¶</a></h2>
<p>See <a class="reference external" href="https://clang.llvm.org/docs/HardwareAssistedAddressSanitizerDesign.html">HardwareAssistedAddressSanitizer</a> for a general overview of a
tag-based approach to memory safety.  MemTagSanitizer followes a
similar implementation strategy, but with the tag storage (shadow)
provided by the hardware.</p>
<p>A quick overview of MTE hardware capabilities:</p>
<ul class="simple">
<li><p>Every 16 aligned bytes of memory can be assigned a 4-bit Allocation Tag.</p></li>
<li><p>Every pointer can have a 4-bit Address Tag that is in its most significant byte.</p></li>
<li><p>Most memory access instructions generate an exception if Address Tag != Allocation Tag.</p></li>
<li><p>Special instructions are provided for fast tag manipulation.</p></li>
</ul>
</section>
<section id="stack-instrumentation">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Stack instrumentation</a><a class="headerlink" href="#stack-instrumentation" title="Link to this heading">¶</a></h2>
<p>Stack-based memory errors are detected by updating Allocation Tag for
each local variable to a random value at the start of its lifetime,
and resetting it to the stack pointer Address Tag at the end of
it. Unallocated stack space is expected to match the Address Tag of
SP; this allows to skip tagging of any variable when memory safety can
be statically proven.</p>
<p>Allocating a truly random tag for each stack variable in a large
function may incur significant code size overhead, because it means
that each variable's address is an independent, non-rematerializable
value; thus a function with N local variables will have extra N live
values to keep through most of its life time.</p>
<p>For this reason MemTagSanitizer generates at most one random tag per
function, called a &quot;base tag&quot;. Other stack variables, if there are
any, are assigned tags at a fixed offset from the base.</p>
<p>Please refer to <a class="reference external" href="https://github.com/google/sanitizers/wiki/Stack-instrumentation-with-ARM-Memory-Tagging-Extension-(MTE)">this document</a>
for more details about stack instrumentation.</p>
</section>
<section id="heap-tagging">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Heap tagging</a><a class="headerlink" href="#heap-tagging" title="Link to this heading">¶</a></h2>
<p><strong>Note:</strong> this part is not implemented as of Oct 2019.</p>
<p>MemTagSanitizer will use <a class="reference internal" href="ScudoHardenedAllocator.html"><span class="doc">Scudo Hardened Allocator</span></a>
with additional code to update memory tags when</p>
<ul class="simple">
<li><p>New memory is obtained from the system.</p></li>
<li><p>An allocation is freed.</p></li>
</ul>
<p>There is no need to change Allocation Tags for the bulk of the
allocated memory in malloc(), as long as a pointer with the matching
Address Tag is returned.</p>
</section>
<section id="more-information">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">More information</a><a class="headerlink" href="#more-information" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://llvm.org/devmtg/2018-10/slides/Serebryany-Stepanov-Tsyrklevich-Memory-Tagging-Slides-LLVM-2018.pdf">LLVM Developer Meeting 2018 talk on Memory Tagging</a></p></li>
<li><p><a class="reference external" href="https://arxiv.org/pdf/1802.09517.pdf">Memory Tagging Whitepaper</a></p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总索引"
             >索引</a></li>
        <li class="right" >
          <a href="SegmentedStacks.html" title="Segmented Stacks in LLVM"
             >下一页</a> |</li>
        <li class="right" >
          <a href="ScudoHardenedAllocator.html" title="Scudo Hardened Allocator"
             >上一页</a> |</li>
  <li><a href="https://llvm.org/">LLVM Home</a>&nbsp;|&nbsp;</li>
  <li><a href="index.html">Documentation</a>&raquo;</li>

          <li class="nav-item nav-item-1"><a href="Reference.html" >Reference</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MemTagSanitizer</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; 版权所有 2003-2025, LLVM Project.
      最后更新于 2025-11-11.
      由 <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3创建。
    </div>
  </body>
</html>