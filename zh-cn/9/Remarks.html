
<!DOCTYPE html>

<html lang="zh-CN" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Remarks &#8212; LLVM 9 文档</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="_static/llvm-theme.css?v=4c4af0c1" />
    <script src="_static/documentation_options.js?v=ee886949"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/translations.js?v=beaddf03"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/llvm-docs-l10n/Remarks.html" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="LLVM Atomic Instructions and Concurrency Guide" href="Atomics.html" />
    <link rel="prev" title="Building a Distribution of LLVM" href="BuildingADistribution.html" />
<script type="text/javascript" src="ltd-provenance.js"></script>
<script type="text/javascript" src="ltd-current.js"></script>
<script type="text/javascript" src="../../ltd-config.js"></script>
<script type="text/javascript" src="../../ltd-flyout.js"></script>

  </head><body>
<div class="logo">
  <a href="index.html">
    <img src="_static/logo.png"
         alt="LLVM Logo" width="250" height="88"/></a>
</div>

    <div class="related" role="navigation" aria-label="Related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="Atomics.html" title="LLVM Atomic Instructions and Concurrency Guide"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="BuildingADistribution.html" title="Building a Distribution of LLVM"
             accesskey="P">上一页</a> |</li>
  <li><a href="https://llvm.org/">LLVM Home</a>&nbsp;|&nbsp;</li>
  <li><a href="index.html">Documentation</a>&raquo;</li>

        <li class="nav-item nav-item-this"><a href="">Remarks</a></li> 
      </ul>
    </div>


    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="remarks">
<h1>Remarks<a class="headerlink" href="#remarks" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="id1">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction-to-the-llvm-remark-diagnostics" id="id2">Introduction to the LLVM remark diagnostics</a></p></li>
<li><p><a class="reference internal" href="#enabling-optimization-remarks" id="id3">Enabling optimization remarks</a></p>
<ul>
<li><p><a class="reference internal" href="#remark-diagnostics" id="id4">Remark diagnostics</a></p></li>
<li><p><a class="reference internal" href="#serialized-remarks" id="id5">Serialized remarks</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#yaml-remarks" id="id6">YAML remarks</a></p></li>
<li><p><a class="reference internal" href="#opt-viewer" id="id7">opt-viewer</a></p>
<ul>
<li><p><a class="reference internal" href="#opt-viewer-py" id="id8">opt-viewer.py</a></p></li>
<li><p><a class="reference internal" href="#opt-stats-py" id="id9">opt-stats.py</a></p></li>
<li><p><a class="reference internal" href="#opt-diff-py" id="id10">opt-diff.py</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#emitting-remark-diagnostics-in-the-object-file" id="id11">Emitting remark diagnostics in the object file</a></p></li>
<li><p><a class="reference internal" href="#c-api" id="id12">C API</a></p></li>
</ul>
</nav>
<section id="introduction-to-the-llvm-remark-diagnostics">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Introduction to the LLVM remark diagnostics</a><a class="headerlink" href="#introduction-to-the-llvm-remark-diagnostics" title="Link to this heading">¶</a></h2>
<p>LLVM is able to emit diagnostics from passes describing whether an optimization
has been performed or missed for a particular reason, which should give more
insight to users about what the compiler did during the compilation pipeline.</p>
<p>There are three main remark types:</p>
<p><code class="docutils literal notranslate"><span class="pre">Passed</span></code></p>
<blockquote>
<div><p>Remarks that describe a successful optimization performed by the compiler.</p>
<dl class="field-list simple">
<dt class="field-odd">Example<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">foo</span> <span class="n">inlined</span> <span class="n">into</span> <span class="n">bar</span> <span class="k">with</span> <span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="n">always</span><span class="p">):</span> <span class="n">always</span> <span class="n">inline</span> <span class="n">attribute</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">Missed</span></code></p>
<blockquote>
<div><p>Remarks that describe an attempt to an optimization by the compiler that
could not be performed.</p>
<dl class="field-list simple">
<dt class="field-odd">Example<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">foo</span> <span class="ow">not</span> <span class="n">inlined</span> <span class="n">into</span> <span class="n">bar</span> <span class="n">because</span> <span class="n">it</span> <span class="n">should</span> <span class="n">never</span> <span class="n">be</span> <span class="n">inlined</span>
<span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="n">never</span><span class="p">):</span> <span class="n">noinline</span> <span class="n">function</span> <span class="n">attribute</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">Analysis</span></code></p>
<blockquote>
<div><p>Remarks that describe the result of an analysis, that can bring more
information to the user regarding the generated code.</p>
<dl class="field-list simple">
<dt class="field-odd">Example<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">16</span> <span class="n">stack</span> <span class="nb">bytes</span> <span class="ow">in</span> <span class="n">function</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">10</span> <span class="n">instructions</span> <span class="ow">in</span> <span class="n">function</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="enabling-optimization-remarks">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Enabling optimization remarks</a><a class="headerlink" href="#enabling-optimization-remarks" title="Link to this heading">¶</a></h2>
<p>There are two modes that are supported for enabling optimization remarks in
LLVM: through remark diagnostics, or through serialized remarks.</p>
<section id="remark-diagnostics">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Remark diagnostics</a><a class="headerlink" href="#remark-diagnostics" title="Link to this heading">¶</a></h3>
<p>Optimization remarks can be emitted as diagnostics. These diagnostics will be
propagated to front-ends if desired, or emitted by tools like <a class="reference internal" href="CommandGuide/llc.html"><span class="doc">llc</span></a> or <a class="reference internal" href="CommandGuide/opt.html"><span class="doc">opt</span></a>.</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-pass-remarks">
<span class="sig-name descname"><span class="pre">-pass-remarks</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;regex&gt;</span></span><a class="headerlink" href="#cmdoption-pass-remarks" title="Link to this definition">¶</a></dt>
<dd><p>Enables optimization remarks from passes whose name match the given (POSIX)
regular expression.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-pass-remarks-missed">
<span class="sig-name descname"><span class="pre">-pass-remarks-missed</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;regex&gt;</span></span><a class="headerlink" href="#cmdoption-pass-remarks-missed" title="Link to this definition">¶</a></dt>
<dd><p>Enables missed optimization remarks from passes whose name match the given
(POSIX) regular expression.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-pass-remarks-analysis">
<span class="sig-name descname"><span class="pre">-pass-remarks-analysis</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;regex&gt;</span></span><a class="headerlink" href="#cmdoption-pass-remarks-analysis" title="Link to this definition">¶</a></dt>
<dd><p>Enables optimization analysis remarks from passes whose name match the given
(POSIX) regular expression.</p>
</dd></dl>

</section>
<section id="serialized-remarks">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Serialized remarks</a><a class="headerlink" href="#serialized-remarks" title="Link to this heading">¶</a></h3>
<p>While diagnostics are useful during development, it is often more useful to
refer to optimization remarks post-compilation, typically during performance
analysis.</p>
<p>For that, LLVM can serialize the remarks produced for each compilation unit to
a file that can be consumed later.</p>
<p>By default, the format of the serialized remarks is <a class="reference internal" href="#yamlremarks"><span class="std std-ref">YAML</span></a>, and it can be accompanied by a <a class="reference internal" href="#remarkssection"><span class="std std-ref">section</span></a>
in the object files to easily retrieve it.</p>
<p><a class="reference internal" href="CommandGuide/llc.html"><span class="doc">llc</span></a> and <a class="reference internal" href="CommandGuide/opt.html"><span class="doc">opt</span></a> support the
following options:</p>
<p><code class="docutils literal notranslate"><span class="pre">Basic</span> <span class="pre">options</span></code></p>
<blockquote>
<div><dl class="std option">
<dt class="sig sig-object std" id="cmdoption-pass-remarks-output">
<span class="sig-name descname"><span class="pre">-pass-remarks-output</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;filename&gt;</span></span><a class="headerlink" href="#cmdoption-pass-remarks-output" title="Link to this definition">¶</a></dt>
<dd><p>Enables the serialization of remarks to a file specified in &lt;filename&gt;.</p>
<p>By default, the output is serialized to <a class="reference internal" href="#yamlremarks"><span class="std std-ref">YAML</span></a>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-pass-remarks-format">
<span class="sig-name descname"><span class="pre">-pass-remarks-format</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;format&gt;</span></span><a class="headerlink" href="#cmdoption-pass-remarks-format" title="Link to this definition">¶</a></dt>
<dd><p>Specifies the output format of the serialized remarks.</p>
<p>Supported formats:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#yamlremarks"><span class="std std-ref">yaml</span></a> (default)</p></li>
</ul>
</dd></dl>

</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">Content</span> <span class="pre">configuration</span></code></p>
<blockquote>
<div><dl class="std option">
<dt class="sig sig-object std" id="cmdoption-pass-remarks-filter">
<span class="sig-name descname"><span class="pre">-pass-remarks-filter</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;regex&gt;</span></span><a class="headerlink" href="#cmdoption-pass-remarks-filter" title="Link to this definition">¶</a></dt>
<dd><p>Only passes whose name match the given (POSIX) regular expression will be
serialized to the final output.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-pass-remarks-with-hotness">
<span class="sig-name descname"><span class="pre">-pass-remarks-with-hotness</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-pass-remarks-with-hotness" title="Link to this definition">¶</a></dt>
<dd><p>With PGO, include profile count in optimization remarks.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-pass-remarks-hotness-threshold">
<span class="sig-name descname"><span class="pre">-pass-remarks-hotness-threshold</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-pass-remarks-hotness-threshold" title="Link to this definition">¶</a></dt>
<dd><p>The minimum profile count required for an optimization remark to be
emitted.</p>
</dd></dl>

</div></blockquote>
<p>Other tools that support remarks:</p>
<p><strong class="program">llvm-lto</strong></p>
<blockquote>
<div><dl class="std option">
<dt class="sig sig-object std" id="cmdoption-lto-pass-remarks-output">
<span class="sig-name descname"><span class="pre">-lto-pass-remarks-output</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;filename&gt;</span></span><a class="headerlink" href="#cmdoption-lto-pass-remarks-output" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-lto-pass-remarks-filter">
<span class="sig-name descname"><span class="pre">-lto-pass-remarks-filter</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;regex&gt;</span></span><a class="headerlink" href="#cmdoption-lto-pass-remarks-filter" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-lto-pass-remarks-format">
<span class="sig-name descname"><span class="pre">-lto-pass-remarks-format</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;format&gt;</span></span><a class="headerlink" href="#cmdoption-lto-pass-remarks-format" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-lto-pass-remarks-with-hotness">
<span class="sig-name descname"><span class="pre">-lto-pass-remarks-with-hotness</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-lto-pass-remarks-with-hotness" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-lto-pass-remarks-hotness-threshold">
<span class="sig-name descname"><span class="pre">-lto-pass-remarks-hotness-threshold</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-lto-pass-remarks-hotness-threshold" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</div></blockquote>
<p><strong class="program">gold-plugin</strong> and <strong class="program">lld</strong></p>
<blockquote>
<div><dl class="std option">
<dt class="sig sig-object std" id="cmdoption-opt-remarks-filename">
<span class="sig-name descname"><span class="pre">-opt-remarks-filename</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;filename&gt;</span></span><a class="headerlink" href="#cmdoption-opt-remarks-filename" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-opt-remarks-filter">
<span class="sig-name descname"><span class="pre">-opt-remarks-filter</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;regex&gt;</span></span><a class="headerlink" href="#cmdoption-opt-remarks-filter" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-opt-remarks-format">
<span class="sig-name descname"><span class="pre">-opt-remarks-format</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;format&gt;</span></span><a class="headerlink" href="#cmdoption-opt-remarks-format" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-opt-remarks-with-hotness">
<span class="sig-name descname"><span class="pre">-opt-remarks-with-hotness</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-opt-remarks-with-hotness" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</div></blockquote>
</section>
</section>
<section id="yaml-remarks">
<span id="yamlremarks"></span><h2><a class="toc-backref" href="#id6" role="doc-backlink">YAML remarks</a><a class="headerlink" href="#yaml-remarks" title="Link to this heading">¶</a></h2>
<p>A typical remark serialized to YAML looks like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span><span class="w"> </span><span class="kt">!&lt;TYPE&gt;</span>
<span class="nt">Pass</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;pass&gt;</span>
<span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;name&gt;</span>
<span class="nt">DebugLoc</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> File</span><span class="p">:</span><span class="w"> </span><span class="nv">&lt;file&gt;</span><span class="p p-Indicator">,</span><span class="nt"> Line</span><span class="p">:</span><span class="w"> </span><span class="nv">&lt;line&gt;</span><span class="p p-Indicator">,</span><span class="nt"> Column</span><span class="p">:</span><span class="w"> </span><span class="nv">&lt;column&gt;</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="nt">Function</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;function&gt;</span>
<span class="nt">Hotness</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;hotness&gt;</span>
<span class="nt">Args</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">&lt;key&gt;</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;value&gt;</span>
<span class="w">    </span><span class="nt">DebugLoc</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> File</span><span class="p">:</span><span class="w"> </span><span class="nv">&lt;arg-file&gt;</span><span class="p p-Indicator">,</span><span class="nt"> Line</span><span class="p">:</span><span class="w"> </span><span class="nv">&lt;arg-line&gt;</span><span class="p p-Indicator">,</span><span class="nt"> Column</span><span class="p">:</span><span class="w"> </span><span class="nv">&lt;arg-column&gt;</span><span class="w"> </span><span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>The following entries are mandatory:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;TYPE&gt;</span></code>: can be <code class="docutils literal notranslate"><span class="pre">Passed</span></code>, <code class="docutils literal notranslate"><span class="pre">Missed</span></code>, <code class="docutils literal notranslate"><span class="pre">Analysis</span></code>,
<code class="docutils literal notranslate"><span class="pre">AnalysisFPCommute</span></code>, <code class="docutils literal notranslate"><span class="pre">AnalysisAliasing</span></code>, <code class="docutils literal notranslate"><span class="pre">Failure</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;pass&gt;</span></code>: the name of the pass that emitted this remark.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span></code>: the name of the remark coming from <code class="docutils literal notranslate"><span class="pre">&lt;pass&gt;</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;function&gt;</span></code>: the mangled name of the function.</p></li>
</ul>
<p>If a <code class="docutils literal notranslate"><span class="pre">DebugLoc</span></code> entry is specified, the following fields are required:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;file&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;line&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;column&gt;</span></code></p></li>
</ul>
<p>If an <code class="docutils literal notranslate"><span class="pre">arg</span></code> entry is specified, the following fields are required:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;key&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;value&gt;</span></code></p></li>
</ul>
<p>If a <code class="docutils literal notranslate"><span class="pre">DebugLoc</span></code> entry is specified within an <code class="docutils literal notranslate"><span class="pre">arg</span></code> entry, the following
fields are required:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;arg-file&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;arg-line&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;arg-column&gt;</span></code></p></li>
</ul>
</section>
<section id="opt-viewer">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">opt-viewer</a><a class="headerlink" href="#opt-viewer" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">opt-viewer</span></code> directory contains a collection of tools that visualize and
summarize serialized remarks.</p>
<section id="opt-viewer-py">
<span id="optviewerpy"></span><h3><a class="toc-backref" href="#id8" role="doc-backlink">opt-viewer.py</a><a class="headerlink" href="#opt-viewer-py" title="Link to this heading">¶</a></h3>
<p>Output a HTML page which gives visual feedback on compiler interactions with
your program.</p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">Examples<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ opt-viewer.py my_yaml_file.opt.yaml
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ opt-viewer.py my_build_dir/
</pre></div>
</div>
</div></blockquote>
</section>
<section id="opt-stats-py">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">opt-stats.py</a><a class="headerlink" href="#opt-stats-py" title="Link to this heading">¶</a></h3>
<p>Output statistics about the optimization remarks in the input set.</p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">Example<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ opt-stats.py my_yaml_file.opt.yaml

Total number of remarks           3


Top 10 remarks by pass:
  inline                         33%
  asm-printer                    33%
  prologepilog                   33%

Top 10 remarks:
  asm-printer/InstructionCount   33%
  inline/NoDefinition            33%
  prologepilog/StackSize         33%
</pre></div>
</div>
</div></blockquote>
</section>
<section id="opt-diff-py">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">opt-diff.py</a><a class="headerlink" href="#opt-diff-py" title="Link to this heading">¶</a></h3>
<p>Produce a new YAML file which contains all of the changes in optimizations
between two YAML files.</p>
<p>Typically, this tool should be used to do diffs between:</p>
<ul class="simple">
<li><p>new compiler + fixed source vs old compiler + fixed source</p></li>
<li><p>fixed compiler + new source vs fixed compiler + old source</p></li>
</ul>
<p>This diff file can be displayed using <a class="reference internal" href="#optviewerpy"><span class="std std-ref">opt-viewer.py</span></a>.</p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">Example<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ opt-diff.py my_opt_yaml1.opt.yaml my_opt_yaml2.opt.yaml -o my_opt_diff.opt.yaml
$ opt-viewer.py my_opt_diff.opt.yaml
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="emitting-remark-diagnostics-in-the-object-file">
<span id="remarkssection"></span><h2><a class="toc-backref" href="#id11" role="doc-backlink">Emitting remark diagnostics in the object file</a><a class="headerlink" href="#emitting-remark-diagnostics-in-the-object-file" title="Link to this heading">¶</a></h2>
<p>A section containing metadata on remark diagnostics will be emitted when
-remarks-section is passed. The section contains:</p>
<ul class="simple">
<li><p>a magic number: &quot;REMARKS\0&quot;</p></li>
<li><p>the version number: a little-endian uint64_t</p></li>
<li><p>the total size of the string table (the size itself excluded):
little-endian uint64_t</p></li>
<li><p>a list of null-terminated strings</p></li>
<li><p>the absolute file path to the serialized remark diagnostics: a
null-terminated string.</p></li>
</ul>
<p>The section is named:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">__LLVM,__remarks</span></code> (MachO)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.remarks</span></code> (ELF)</p></li>
</ul>
</section>
<section id="c-api">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">C API</a><a class="headerlink" href="#c-api" title="Link to this heading">¶</a></h2>
<p>LLVM provides a library that can be used to parse remarks through a shared
library named <code class="docutils literal notranslate"><span class="pre">libRemarks</span></code>.</p>
<p>The typical usage through the C API is like the following:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">LLVMRemarkParserRef</span><span class="w"> </span><span class="n">Parser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LLVMRemarkParserCreateYAML</span><span class="p">(</span><span class="n">Buf</span><span class="p">,</span><span class="w"> </span><span class="n">Size</span><span class="p">);</span>
<span class="n">LLVMRemarkEntryRef</span><span class="w"> </span><span class="n">Remark</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">Remark</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LLVMRemarkParserGetNext</span><span class="p">(</span><span class="n">Parser</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="c1">// use Remark</span>
<span class="w">   </span><span class="n">LLVMRemarkEntryDispose</span><span class="p">(</span><span class="n">Remark</span><span class="p">);</span><span class="w"> </span><span class="c1">// Release memory.</span>
<span class="p">}</span>
<span class="kt">bool</span><span class="w"> </span><span class="n">HasError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LLVMRemarkParserHasError</span><span class="p">(</span><span class="n">Parser</span><span class="p">);</span>
<span class="n">LLVMRemarkParserDispose</span><span class="p">(</span><span class="n">Parser</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总索引"
             >索引</a></li>
        <li class="right" >
          <a href="Atomics.html" title="LLVM Atomic Instructions and Concurrency Guide"
             >下一页</a> |</li>
        <li class="right" >
          <a href="BuildingADistribution.html" title="Building a Distribution of LLVM"
             >上一页</a> |</li>
  <li><a href="https://llvm.org/">LLVM Home</a>&nbsp;|&nbsp;</li>
  <li><a href="index.html">Documentation</a>&raquo;</li>

        <li class="nav-item nav-item-this"><a href="">Remarks</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; 版权所有 2003-2025, LLVM Project.
      最后更新于 2025-10-28.
      由 <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3创建。
    </div>
  </body>
</html>