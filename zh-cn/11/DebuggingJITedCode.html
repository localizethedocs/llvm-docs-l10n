
<!DOCTYPE html>

<html lang="zh-CN" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Debugging JIT-ed Code With GDB &#8212; LLVM 11 文档</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="_static/llvm-theme.css?v=4c4af0c1" />
    <script src="_static/documentation_options.js?v=6ed079f1"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/translations.js?v=beaddf03"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/llvm-docs-l10n/DebuggingJITedCode.html" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="A guide to Dockerfiles for building LLVM" href="Docker.html" />
    <link rel="prev" title="LLVM Code Coverage Mapping Format" href="CoverageMappingFormat.html" />
<script type="text/javascript" src="ltd-provenance.js"></script>
<script type="text/javascript" src="ltd-current.js"></script>
<script type="text/javascript" src="../../ltd-config.js"></script>
<script type="text/javascript" src="../../ltd-flyout.js"></script>

  </head><body>
<div class="logo">
  <a href="index.html">
    <img src="_static/logo.png"
         alt="LLVM Logo" width="250" height="88"/></a>
</div>

    <div class="related" role="navigation" aria-label="Related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="Docker.html" title="A guide to Dockerfiles for building LLVM"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="CoverageMappingFormat.html" title="LLVM Code Coverage Mapping Format"
             accesskey="P">上一页</a> |</li>
  <li><a href="https://llvm.org/">LLVM Home</a>&nbsp;|&nbsp;</li>
  <li><a href="index.html">Documentation</a>&raquo;</li>

          <li class="nav-item nav-item-1"><a href="UserGuides.html" accesskey="U">User Guides</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Debugging JIT-ed Code With GDB</a></li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">

<h3>Documentation</h3>

<ul class="want-points">
    <li><a href="GettingStartedTutorials.html">Getting Started/Tutorials</a></li>
    <li><a href="UserGuides.html">User Guides</a></li>
    <li><a href="Reference.html">Reference</a></li>
</ul>

<h3>Getting Involved</h3>

<ul class="want-points">
    <li><a href="Contributing.html">Contributing to LLVM</a></li>
    <li><a href="HowToSubmitABug.html">Submitting Bug Reports</a></li>
    <li><a href="GettingInvolved.html#mailing-lists">Mailing Lists</a></li>
    <li><a href="GettingInvolved.html#discord">Discord</a></li>
    <li><a href="GettingInvolved.html#meetups-and-social-events">Meetups and Social Events</a></li>
</ul>

<h3>Additional Links</h3>

<ul class="want-points">
    <li><a href="FAQ.html">FAQ</a></li>
    <li><a href="Lexicon.html">Glossary</a></li>
    <li><a href="https://llvm.org/pubs">Publications</a></li>
    <li><a href="https://github.com/llvm/llvm-project/">Github Repository</a></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/DebuggingJITedCode.rst.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="提交" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="debugging-jit-ed-code-with-gdb">
<h1>Debugging JIT-ed Code With GDB<a class="headerlink" href="#debugging-jit-ed-code-with-gdb" title="Link to this heading">¶</a></h1>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading">¶</a></h2>
<p>Without special runtime support, debugging dynamically generated code with
GDB (as well as most debuggers) can be quite painful.  Debuggers generally
read debug information from the object file of the code, but for JITed
code, there is no such file to look for.</p>
<p>In order to communicate the necessary debug info to GDB, an interface for
registering JITed code with debuggers has been designed and implemented for
GDB and LLVM MCJIT.  At a high level, whenever MCJIT generates new machine code,
it does so in an in-memory object file that contains the debug information in
DWARF format.  MCJIT then adds this in-memory object file to a global list of
dynamically generated object files and calls a special function
(<code class="docutils literal notranslate"><span class="pre">__jit_debug_register_code</span></code>) marked noinline that GDB knows about.  When
GDB attaches to a process, it puts a breakpoint in this function and loads all
of the object files in the global list.  When MCJIT calls the registration
function, GDB catches the breakpoint signal, loads the new object file from
the inferior's memory, and resumes the execution.  In this way, GDB can get the
necessary debug information.</p>
</section>
<section id="gdb-version">
<h2>GDB Version<a class="headerlink" href="#gdb-version" title="Link to this heading">¶</a></h2>
<p>In order to debug code JIT-ed by LLVM, you need GDB 7.0 or newer, which is
available on most modern distributions of Linux.  The version of GDB that
Apple ships with Xcode has been frozen at 6.3 for a while.  LLDB may be a
better option for debugging JIT-ed code on macOS.</p>
</section>
<section id="debugging-mcjit-ed-code">
<h2>Debugging MCJIT-ed code<a class="headerlink" href="#debugging-mcjit-ed-code" title="Link to this heading">¶</a></h2>
<p>The emerging MCJIT component of LLVM allows full debugging of JIT-ed code with
GDB.  This is due to MCJIT's ability to use the MC emitter to provide full
DWARF debugging information to GDB.</p>
<p>Note that lli has to be passed the <code class="docutils literal notranslate"><span class="pre">-jit-kind=mcjit</span></code> flag to JIT the code with
MCJIT instead of the old JIT.</p>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Link to this heading">¶</a></h3>
<p>Consider the following C code (with line numbers added to make the example
easier to follow):</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">compute_factorial</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="mi">2</span><span class="w">   </span><span class="p">{</span>
<span class="mi">3</span><span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="mi">4</span><span class="w">           </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="mi">5</span>
<span class="mi">6</span><span class="w">       </span><span class="kt">int</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="mi">7</span><span class="w">       </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">--</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="mi">8</span><span class="w">           </span><span class="n">f</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="mi">9</span><span class="w">       </span><span class="k">return</span><span class="w"> </span><span class="n">f</span><span class="p">;</span>
<span class="mi">10</span><span class="w">  </span><span class="p">}</span>
<span class="mi">11</span>
<span class="mi">12</span>
<span class="mi">13</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span>
<span class="mi">14</span><span class="w">  </span><span class="p">{</span>
<span class="mi">15</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="mi">16</span><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="mi">17</span><span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="n">firstletter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
<span class="mi">18</span><span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compute_factorial</span><span class="p">(</span><span class="n">firstletter</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">);</span>
<span class="mi">19</span>
<span class="mi">20</span><span class="w">      </span><span class="c1">// Returned result is clipped at 255...</span>
<span class="mi">21</span><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="mi">22</span><span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
<p>Here is a sample command line session that shows how to build and run this
code via <code class="docutils literal notranslate"><span class="pre">lli</span></code> inside GDB:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nv">$BINPATH</span>/clang<span class="w"> </span>-cc1<span class="w"> </span>-O0<span class="w"> </span>-g<span class="w"> </span>-emit-llvm<span class="w"> </span>showdebug.c
$<span class="w"> </span>gdb<span class="w"> </span>--quiet<span class="w"> </span>--args<span class="w"> </span><span class="nv">$BINPATH</span>/lli<span class="w"> </span>-jit-kind<span class="o">=</span>mcjit<span class="w"> </span>showdebug.ll<span class="w"> </span><span class="m">5</span>
Reading<span class="w"> </span>symbols<span class="w"> </span>from<span class="w"> </span><span class="nv">$BINPATH</span>/lli...done.
<span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>b<span class="w"> </span>showdebug.c:6
No<span class="w"> </span><span class="nb">source</span><span class="w"> </span>file<span class="w"> </span>named<span class="w"> </span>showdebug.c.
Make<span class="w"> </span>breakpoint<span class="w"> </span>pending<span class="w"> </span>on<span class="w"> </span>future<span class="w"> </span>shared<span class="w"> </span>library<span class="w"> </span>load?<span class="w"> </span><span class="o">(</span>y<span class="w"> </span>or<span class="w"> </span><span class="o">[</span>n<span class="o">])</span><span class="w"> </span>y
Breakpoint<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>showdebug.c:6<span class="o">)</span><span class="w"> </span>pending.
<span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>r
Starting<span class="w"> </span>program:<span class="w"> </span><span class="nv">$BINPATH</span>/lli<span class="w"> </span>-jit-kind<span class="o">=</span>mcjit<span class="w"> </span>showdebug.ll<span class="w"> </span><span class="m">5</span>
<span class="o">[</span>Thread<span class="w"> </span>debugging<span class="w"> </span>using<span class="w"> </span>libthread_db<span class="w"> </span>enabled<span class="o">]</span>

Breakpoint<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>compute_factorial<span class="w"> </span><span class="o">(</span><span class="nv">n</span><span class="o">=</span><span class="m">5</span><span class="o">)</span><span class="w"> </span>at<span class="w"> </span>showdebug.c:6
<span class="m">6</span><span class="w">        </span>int<span class="w"> </span><span class="nv">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>n<span class="p">;</span>
<span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>p<span class="w"> </span>n
<span class="nv">$1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span>
<span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>p<span class="w"> </span>f
<span class="nv">$2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>n
<span class="m">7</span><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="o">(</span>--n<span class="w"> </span>&gt;<span class="w"> </span><span class="m">1</span><span class="o">)</span>
<span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>p<span class="w"> </span>f
<span class="nv">$3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span>
<span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>b<span class="w"> </span>showdebug.c:9
Breakpoint<span class="w"> </span><span class="m">2</span><span class="w"> </span>at<span class="w"> </span>0x7ffff7ed404c:<span class="w"> </span>file<span class="w"> </span>showdebug.c,<span class="w"> </span>line<span class="w"> </span><span class="m">9</span>.
<span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>c
Continuing.

Breakpoint<span class="w"> </span><span class="m">2</span>,<span class="w"> </span>compute_factorial<span class="w"> </span><span class="o">(</span><span class="nv">n</span><span class="o">=</span><span class="m">1</span><span class="o">)</span><span class="w"> </span>at<span class="w"> </span>showdebug.c:9
<span class="m">9</span><span class="w">        </span><span class="k">return</span><span class="w"> </span>f<span class="p">;</span>
<span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>p<span class="w"> </span>f
<span class="nv">$4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">120</span>
<span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>bt
<span class="c1">#0  compute_factorial (n=1) at showdebug.c:9</span>
<span class="c1">#1  0x00007ffff7ed40a9 in main (argc=2, argv=0x16677e0) at showdebug.c:18</span>
<span class="c1">#2  0x3500000001652748 in ?? ()</span>
<span class="c1">#3  0x00000000016677e0 in ?? ()</span>
<span class="c1">#4  0x0000000000000002 in ?? ()</span>
<span class="c1">#5  0x0000000000d953b3 in llvm::MCJIT::runFunction (this=0x16151f0, F=0x1603020, ArgValues=...) at /home/ebenders_test/llvm_svn_rw/lib/ExecutionEngine/MCJIT/MCJIT.cpp:161</span>
<span class="c1">#6  0x0000000000dc8872 in llvm::ExecutionEngine::runFunctionAsMain (this=0x16151f0, Fn=0x1603020, argv=..., envp=0x7fffffffe040)</span>
<span class="w">    </span>at<span class="w"> </span>/home/ebenders_test/llvm_svn_rw/lib/ExecutionEngine/ExecutionEngine.cpp:397
<span class="c1">#7  0x000000000059c583 in main (argc=4, argv=0x7fffffffe018, envp=0x7fffffffe040) at /home/ebenders_test/llvm_svn_rw/tools/lli/lli.cpp:324</span>
<span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>finish
Run<span class="w"> </span>till<span class="w"> </span><span class="nb">exit</span><span class="w"> </span>from<span class="w"> </span><span class="c1">#0  compute_factorial (n=1) at showdebug.c:9</span>
0x00007ffff7ed40a9<span class="w"> </span><span class="k">in</span><span class="w"> </span>main<span class="w"> </span><span class="o">(</span><span class="nv">argc</span><span class="o">=</span><span class="m">2</span>,<span class="w"> </span><span class="nv">argv</span><span class="o">=</span>0x16677e0<span class="o">)</span><span class="w"> </span>at<span class="w"> </span>showdebug.c:18
<span class="m">18</span><span class="w">       </span>int<span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>compute_factorial<span class="o">(</span>firstletter<span class="w"> </span>-<span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="o">)</span><span class="p">;</span>
Value<span class="w"> </span>returned<span class="w"> </span>is<span class="w"> </span><span class="nv">$5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">120</span>
<span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>p<span class="w"> </span>result
<span class="nv">$6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">23406408</span>
<span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>n
<span class="m">21</span><span class="w">       </span><span class="k">return</span><span class="w"> </span>result<span class="p">;</span>
<span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>p<span class="w"> </span>result
<span class="nv">$7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">120</span>
<span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>c
Continuing.

Program<span class="w"> </span>exited<span class="w"> </span>with<span class="w"> </span>code<span class="w"> </span><span class="m">0170</span>.
<span class="o">(</span>gdb<span class="o">)</span>
</pre></div>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总索引"
             >索引</a></li>
        <li class="right" >
          <a href="Docker.html" title="A guide to Dockerfiles for building LLVM"
             >下一页</a> |</li>
        <li class="right" >
          <a href="CoverageMappingFormat.html" title="LLVM Code Coverage Mapping Format"
             >上一页</a> |</li>
  <li><a href="https://llvm.org/">LLVM Home</a>&nbsp;|&nbsp;</li>
  <li><a href="index.html">Documentation</a>&raquo;</li>

          <li class="nav-item nav-item-1"><a href="UserGuides.html" >User Guides</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Debugging JIT-ed Code With GDB</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; 版权所有 2003-2025, LLVM Project.
      最后更新于 2025-11-11.
      由 <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3创建。
    </div>
  </body>
</html>