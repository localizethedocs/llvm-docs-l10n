
<!DOCTYPE html>

<html lang="en-US" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Content Addressable Storage &#8212; LLVM  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="_static/llvm-theme.css?v=4c4af0c1" />
    <script src="_static/documentation_options.js?v=ccd1e645"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/llvm-docs-l10n/ContentAddressableStorage.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Convergence And Uniformity" href="ConvergenceAndUniformity.html" />
    <link rel="prev" title="llvm-remarkutil - Remark utility" href="CommandGuide/llvm-remarkutil.html" />
<script type="text/javascript" src="ltd-provenance.js"></script>
<script type="text/javascript" src="ltd-current.js"></script>
<script type="text/javascript" src="../../ltd-config.js"></script>
<script type="text/javascript" src="../../ltd-flyout.js"></script>

  </head><body>
<div class="logo">
  <a href="index.html">
    <img src="_static/logo.png"
         alt="LLVM Logo" width="250" height="88"/></a>
</div>

    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ConvergenceAndUniformity.html" title="Convergence And Uniformity"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="CommandGuide/llvm-remarkutil.html" title="llvm-remarkutil - Remark utility"
             accesskey="P">previous</a> |</li>
  <li><a href="https://llvm.org/">LLVM Home</a>&nbsp;|&nbsp;</li>
  <li><a href="index.html">Documentation</a>&raquo;</li>

          <li class="nav-item nav-item-1"><a href="Reference.html" accesskey="U">Reference</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Content Addressable Storage</a></li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">

<h3>Documentation</h3>

<ul class="want-points">
    <li><a href="GettingStartedTutorials.html">Getting Started/Tutorials</a></li>
    <li><a href="UserGuides.html">User Guides</a></li>
    <li><a href="Reference.html">Reference</a></li>
</ul>

<h3>Getting Involved</h3>

<ul class="want-points">
    <li><a href="Contributing.html">Contributing to LLVM</a></li>
    <li><a href="HowToSubmitABug.html">Submitting Bug Reports</a></li>
    <li><a href="GettingInvolved.html#mailing-lists">Mailing Lists</a></li>
    <li><a href="GettingInvolved.html#discord">Discord</a></li>
    <li><a href="GettingInvolved.html#meetups-and-social-events">Meetups and Social Events</a></li>
</ul>

<h3>Additional Links</h3>

<ul class="want-points">
    <li><a href="FAQ.html">FAQ</a></li>
    <li><a href="Lexicon.html">Glossary</a></li>
    <li><a href="https://llvm.org/pubs">Publications</a></li>
    <li><a href="https://github.com/llvm/llvm-project/">Github Repository</a></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/ContentAddressableStorage.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="content-addressable-storage">
<h1>Content Addressable Storage<a class="headerlink" href="#content-addressable-storage" title="Link to this heading">¶</a></h1>
<section id="introduction-to-cas">
<h2>Introduction to CAS<a class="headerlink" href="#introduction-to-cas" title="Link to this heading">¶</a></h2>
<p>Content Addressable Storage, or <code class="docutils literal notranslate"><span class="pre">CAS</span></code>, is a storage system that assigns
unique addresses to the data stored. It is very useful for data deduplicaton
and creating unique identifiers.</p>
<p>Unlike other kinds of storage systems, like file systems, CAS is immutable. It
is more reliable to model a computation by representing the inputs and outputs
of the computation using objects stored in CAS.</p>
<p>The basic unit of the CAS library is a CASObject, where it contains:</p>
<ul class="simple">
<li><p>Data: arbitrary data</p></li>
<li><p>References: references to other CASObject</p></li>
</ul>
<p>It can be conceptually modeled as something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">CASObject</span> <span class="p">{</span>
  <span class="n">ArrayRef</span><span class="o">&lt;</span><span class="n">char</span><span class="o">&gt;</span> <span class="n">Data</span><span class="p">;</span>
  <span class="n">ArrayRef</span><span class="o">&lt;</span><span class="n">CASObject</span><span class="o">*&gt;</span> <span class="n">Refs</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>With this abstraction, it is possible to compose <code class="docutils literal notranslate"><span class="pre">CASObject</span></code>s into a DAG that is
capable of representing complicated data structures, while still allowing data
deduplication. Note you can compare two DAGs by just comparing the CASObject
hash of two root nodes.</p>
</section>
<section id="llvm-cas-library-user-guide">
<h2>LLVM CAS Library User Guide<a class="headerlink" href="#llvm-cas-library-user-guide" title="Link to this heading">¶</a></h2>
<p>The CAS-like storage provided in LLVM is <code class="docutils literal notranslate"><span class="pre">llvm::cas::ObjectStore</span></code>.
To reference a CASObject, there are few different abstractions provided
with different trade-offs:</p>
<section id="objectref">
<h3>ObjectRef<a class="headerlink" href="#objectref" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ObjectRef</span></code> is a lightweight reference to a CASObject stored in the CAS.
This is the most commonly used abstraction and it is cheap to copy/pass
along. It has following properties:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ObjectRef</span></code> is only meaningful within the <code class="docutils literal notranslate"><span class="pre">ObjectStore</span></code> that created the ref.
<code class="docutils literal notranslate"><span class="pre">ObjectRef</span></code> created by different <code class="docutils literal notranslate"><span class="pre">ObjectStore</span></code> cannot be cross-referenced or
compared.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ObjectRef</span></code> doesn’t guarantee the existence of the CASObject it points to. An
explicit load is required before accessing the data stored in CASObject.
This load can also fail, for reasons like (but not limited to): object does
not exist, corrupted CAS storage, operation timeout, etc.</p></li>
<li><p>If two <code class="docutils literal notranslate"><span class="pre">ObjectRef</span></code> are equal, it is guaranteed that the object they point to
are identical (if they exist). If they are not equal, the underlying objects are
guaranteed to be not the same.</p></li>
</ul>
</section>
<section id="objectproxy">
<h3>ObjectProxy<a class="headerlink" href="#objectproxy" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ObjectProxy</span></code> represents a loaded CASObject. With an <code class="docutils literal notranslate"><span class="pre">ObjectProxy</span></code>, the
underlying stored data and references can be accessed without the need
of error handling. The class APIs also provide convenient methods to
access underlying data. The lifetime of the underlying data is equal to
the lifetime of the instance of <code class="docutils literal notranslate"><span class="pre">ObjectStore</span></code> unless explicitly copied.</p>
</section>
<section id="casid">
<h3>CASID<a class="headerlink" href="#casid" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">CASID</span></code> is the hash identifier for CASObjects. It owns the underlying
storage for hash value so it can be expensive to copy and compare depending
on the hash algorithm. <code class="docutils literal notranslate"><span class="pre">CASID</span></code> is generally only useful in rare situations
like printing raw hash value or exchanging hash values between different
CAS instances with the same hashing schema.</p>
</section>
<section id="objectstore">
<h3>ObjectStore<a class="headerlink" href="#objectstore" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ObjectStore</span></code> is the CAS-like object storage. It provides API to save
and load CASObjects, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ObjectRef</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">;</span>
<span class="n">Expected</span><span class="o">&lt;</span><span class="n">ObjectRef</span><span class="o">&gt;</span> <span class="n">Stored</span> <span class="o">=</span> <span class="n">ObjectStore</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">});</span>
<span class="n">Expected</span><span class="o">&lt;</span><span class="n">ObjectProxy</span><span class="o">&gt;</span> <span class="n">Loaded</span> <span class="o">=</span> <span class="n">ObjectStore</span><span class="o">.</span><span class="n">getProxy</span><span class="p">(</span><span class="n">C</span><span class="p">);</span>
</pre></div>
</div>
<p>It also provides APIs to convert between <code class="docutils literal notranslate"><span class="pre">ObjectRef</span></code>, <code class="docutils literal notranslate"><span class="pre">ObjectProxy</span></code> and
<code class="docutils literal notranslate"><span class="pre">CASID</span></code>.</p>
</section>
<section id="actioncache">
<h3>ActionCache<a class="headerlink" href="#actioncache" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ActionCache</span></code> is a key value storage can be used to associate two CASIDs. It is
usually used with an <code class="docutils literal notranslate"><span class="pre">ObjectStore</span></code> to map an input CASObject to an output CASObject
with their CASIDs.</p>
<p><code class="docutils literal notranslate"><span class="pre">ActionCache</span></code> has APIs like following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CASID</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">;</span>
<span class="n">Error</span> <span class="n">E</span> <span class="o">=</span> <span class="n">ActionCache</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>
<span class="n">Expected</span><span class="o">&lt;</span><span class="n">std</span><span class="p">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">CASID</span><span class="o">&gt;&gt;</span> <span class="n">Result</span> <span class="o">=</span> <span class="n">ActionCache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">A</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="cas-library-implementation-guide">
<h2>CAS Library Implementation Guide<a class="headerlink" href="#cas-library-implementation-guide" title="Link to this heading">¶</a></h2>
<p>The LLVM ObjectStore API was designed so that it is easy to add
customized CAS implementations that are interchangeable with the builtin
ones.</p>
<p>To add your own implementation, you just need to add a subclass to
<code class="docutils literal notranslate"><span class="pre">llvm::cas::ObjectStore</span></code> and implement all its pure virtual methods.
To be interchangeable with LLVM ObjectStore, the new CAS implementation
needs to conform to following contracts:</p>
<ul class="simple">
<li><p>Different CASObjects stored in the ObjectStore need to have a different hash
and result in a different <code class="docutils literal notranslate"><span class="pre">ObjectRef</span></code>. Similarly, the same CASObject should have
the same hash and the same <code class="docutils literal notranslate"><span class="pre">ObjectRef</span></code>. Note: two different CASObjects with
identical data but different references are considered different objects.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ObjectRef</span></code>s are only comparable within the same <code class="docutils literal notranslate"><span class="pre">ObjectStore</span></code> instance, and
can be used to determine the equality of the underlying CASObjects.</p></li>
<li><p>The loaded objects from the ObjectStore need to have a lifetime at least as
long as the ObjectStore itself so it is always legal to access the loaded data
without holding on the <code class="docutils literal notranslate"><span class="pre">ObjectProxy</span></code> until the <code class="docutils literal notranslate"><span class="pre">ObjectStore</span></code> is destroyed.</p></li>
</ul>
<p>If not specified, the behavior can be implementation defined. For example,
<code class="docutils literal notranslate"><span class="pre">ObjectRef</span></code> can be used to point to a loaded CASObject so
<code class="docutils literal notranslate"><span class="pre">ObjectStore</span></code> never fails to load. It is also legal to use a stricter model
than required. For example, the underlying value inside <code class="docutils literal notranslate"><span class="pre">ObjectRef</span></code> can be
the unique indentities of the objects across multiple <code class="docutils literal notranslate"><span class="pre">ObjectStore</span></code> instances,
but comparing such <code class="docutils literal notranslate"><span class="pre">ObjectRef</span></code> from different <code class="docutils literal notranslate"><span class="pre">ObjectStore</span></code> is still illegal.</p>
<p>For CAS library implementers, there is also an <code class="docutils literal notranslate"><span class="pre">ObjectHandle</span></code> class that
is an internal representation of a loaded CASObject reference.
<code class="docutils literal notranslate"><span class="pre">ObjectProxy</span></code> is just a pair of <code class="docutils literal notranslate"><span class="pre">ObjectHandle</span></code> and <code class="docutils literal notranslate"><span class="pre">ObjectStore</span></code>, and
just like <code class="docutils literal notranslate"><span class="pre">ObjectRef</span></code>, <code class="docutils literal notranslate"><span class="pre">ObjectHandle</span></code> is only useful when paired with
the <code class="docutils literal notranslate"><span class="pre">ObjectStore</span></code> that knows about the loaded CASObject.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ConvergenceAndUniformity.html" title="Convergence And Uniformity"
             >next</a> |</li>
        <li class="right" >
          <a href="CommandGuide/llvm-remarkutil.html" title="llvm-remarkutil - Remark utility"
             >previous</a> |</li>
  <li><a href="https://llvm.org/">LLVM Home</a>&nbsp;|&nbsp;</li>
  <li><a href="index.html">Documentation</a>&raquo;</li>

          <li class="nav-item nav-item-1"><a href="Reference.html" >Reference</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Content Addressable Storage</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2003-2025, LLVM Project.
      Last updated on 2025-10-27.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>